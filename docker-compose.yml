version: "3.8"

services:
    # Laravel Application
    app:
        build:
            context: .
            dockerfile: Dockerfile
        container_name: booking_sport_app
        restart: unless-stopped
        ports:
            - "8000:80"
        volumes:
            - .:/var/www/html
            - ./storage:/var/www/html/storage
        environment:
            - APP_ENV=local
            - APP_DEBUG=true
            - DB_HOST=mysql
            - DB_DATABASE=booking_sport
            - DB_USERNAME=booking_sport
            - DB_PASSWORD=password
            - REDIS_HOST=redis
            - REDIS_PORT=6379
            - QUEUE_CONNECTION=redis
            - CACHE_DRIVER=redis
            - SESSION_DRIVER=redis
        depends_on:
            - mysql
            - redis
        networks:
            - booking_sport_network

    # MySQL Database
    mysql:
        image: mysql:8.0
        container_name: booking_sport_mysql
        restart: unless-stopped
        environment:
            MYSQL_DATABASE: booking_sport
            MYSQL_ROOT_PASSWORD: root
            MYSQL_PASSWORD: password
            MYSQL_USER: booking_sport
        ports:
            - "3306:3306"
        volumes:
            - mysql_data:/var/lib/mysql
        networks:
            - booking_sport_network

    # Redis for caching and queues
    redis:
        build:
            context: .
            dockerfile: docker/redis/Dockerfile
        container_name: booking_sport_redis
        restart: unless-stopped
        ports:
            - "6379:6379"
        volumes:
            - redis_data:/data
        networks:
            - booking_sport_network

    # Mailpit for local email testing
    mailpit:
        image: axllent/mailpit
        container_name: booking_sport_mailpit
        restart: unless-stopped
        ports:
            - "1025:1025" # SMTP port
            - "8025:8025" # Web UI port
        networks:
            - booking_sport_network

volumes:
    mysql_data:
        driver: local
    redis_data:
        driver: local

networks:
    booking_sport_network:
        driver: bridge
